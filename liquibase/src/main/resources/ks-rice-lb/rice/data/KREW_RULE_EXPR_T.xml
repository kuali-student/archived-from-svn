<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
	<changeSet id="KREW_RULE_EXPR_T-initial-data" author="alubbers">
		<insert tableName="KREW_RULE_EXPR_T">
			<column name="OBJ_ID" value="616A0754-3BA6-39DF-9A1B-11432849DC6B"/>
			<column name="RULE_EXPR" value="import edu.sampleu.recipe.util.RecipeUtils
		        import org.apache.commons.lang.StringUtils
				import org.kuali.rice.kew.engine.RouteContext;
				import org.kuali.rice.kew.rule.Rule;
				import org.kuali.rice.kew.rule.RuleExpressionResult;
		        
				String ingredients = RecipeUtils.getRecipeIngredientsFromRecipeDocumentContent(routeContext)
		
				if(StringUtils.containsIgnoreCase(ingredients, &quot;chicken&quot;)) {
					return RecipeUtils.constructGroupApprovalRequest(&quot;KR-WKFLW:ChickenRecipeMasters&quot;, rule)
		        } else {
		        	/* Return an empty route request */
		        	return RecipeUtils.constructEmptyApprovalRequest(rule);
		        }"/>
			<column name="RULE_EXPR_ID" value="2000"/>
			<column name="TYP" value="BSF:groovy"/>
			<column name="VER_NBR" value="1"/>
		</insert>
		<insert tableName="KREW_RULE_EXPR_T">
			<column name="OBJ_ID" value="3364EB47-6407-9C45-8AAD-7A8310266208"/>
			<column name="RULE_EXPR" value="import javax.xml.namespace.QName
				import org.kuali.rice.resourceloader.GlobalResourceLoader
				import edu.sampleu.magazine.service.MagazineService
		        import edu.sampleu.recipe.util.RecipeUtils
		        import org.apache.commons.lang.StringUtils
				import org.kuali.rice.kew.engine.RouteContext
				import org.kuali.rice.kew.rule.Rule
				import org.kuali.rice.kew.rule.RuleExpressionResult
		        
				String origin = RecipeUtils.getRecipeOriginFromRecipeDocumentContent(routeContext)
				
				QName serviceName = new QName(&quot;magazineNamespace&quot;, &quot;magazineSoapService&quot;)
				MagazineService magazineSoapService = (MagazineService) GlobalResourceLoader.getService(serviceName)
				String managedMagazines[] = magazineSoapService.getAllManagedMagazines()
		
				if(ArrayUtils.contains(managedMagazines, origin)) {
					return RecipeUtils.constructGroupApprovalRequest(&quot;KR-WKFLW:MagazineManagers&quot;, rule)
		        } else {
		        	/* Return an empty route request */
		        	return RecipeUtils.constructEmptyApprovalRequest(rule);
		        }"/>
			<column name="RULE_EXPR_ID" value="2001"/>
			<column name="TYP" value="BSF:groovy"/>
			<column name="VER_NBR" value="1"/>
		</insert>
	</changeSet>
</databaseChangeLog>

<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright 2010 The Kuali Foundation Licensed under the
    Educational Community License, Version 2.0 (the "License"); you may
    not use this file except in compliance with the License. You may
    obtain a copy of the License at

    http://www.osedu.org/licenses/ECL-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an "AS IS"
    BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
    or implied. See the License for the specific language governing
    permissions and limitations under the License.

-->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:search="http://student.kuali.org/xsd/search-extension"
       xmlns:dict="http://student.kuali.org/xsd/dictionary-extension"
       xsi:schemaLocation="
	http://student.kuali.org/xsd/search-extension http://student.kuali.org/xsd/search-extension/search-extension.xsd
	http://student.kuali.org/xsd/dictionary-extension http://student.kuali.org/xsd/dictionary-extension/dictionary-extension.xsd
	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
	 ">

    <import resource="classpath:lu-search-config.xml"/>

    <search:searchType id="myplan.distinct.clu.divisions">
        <search:searchResultTypeInfo>
            <search:name>myplan name</search:name>
            <search:desc>myplan desc</search:desc>
            <search:resultColumns>
                <!-- this is wrong, but works. i haven't figured out how to create a new "bean" for this purpose -->
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="myplan.lu.search.current">
        <search:searchResultTypeInfo>
            <search:name>myplan name</search:name>
            <search:desc>myplan desc</search:desc>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="myplan.lu.search.current.allcampus">
        <search:searchResultTypeInfo>
            <search:name>myplan name</search:name>
            <search:desc>myplan desc</search:desc>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="myplan.lu.search.fulltext">
        <search:searchResultTypeInfo>
            <search:name>myplan name</search:name>
            <search:desc>myplan desc</search:desc>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="myplan.lu.search.divisionAndCode">
        <search:searchResultTypeInfo>
            <search:name>myplan name</search:name>
            <search:desc>myplan desc</search:desc>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="myplan.lu.search.divisionAndLevel">
        <search:searchResultTypeInfo>
            <search:name>myplan name</search:name>
            <search:desc>myplan desc</search:desc>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="myplan.lu.search.division">
        <search:searchResultTypeInfo>
            <search:name>myplan name</search:name>
            <search:desc>myplan desc</search:desc>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <bean id="queryMap" parent="queryMap-parent">
        <property name="sourceMap">
            <map merge="true">

                <entry key="myplan.distinct.clu.divisions">
                    <value>
                        SELECT
                            distinct( ident.division )
                        FROM CluIdentifier ident
                        WHERE ident.division IS NOT null
                    </value>
                </entry>

                <entry key="myplan.lu.search.current">
                    <value>
                        SELECT
                            clu.id
                        FROM CluCampusLocation loc
                        LEFT JOIN loc.clu clu
                        LEFT JOIN clu.officialIdentifier officialIdentifier
                        LEFT JOIN clu.descr cludesc
                        WHERE
                            clu.version.currentVersionStart &lt;= CURRENT_DATE
                            AND
                            (
                                clu.version.currentVersionEnd &gt; CURRENT_DATE
                                OR
                                clu.version.currentVersionEnd IS NULL
                            )
                            AND
                            (
                                UPPER( officialIdentifier.longName ) LIKE UPPER( '%'||:queryText||'%' )
                                OR
                                officialIdentifier.division LIKE UPPER( '%'||:queryText||'%' )
                                OR
                                officialIdentifier.code LIKE UPPER( '%'||:queryText||'%' )
                                OR
                                UPPER( cludesc.plain ) LIKE UPPER( '%'||:queryText||'%' )
                            )
                            AND
                            officialIdentifier.level LIKE :queryLevel
                            AND
                            loc.campusLocation IN ( :campus1, :campus2, :campus3 )
                    </value>
                </entry>

                <entry key="myplan.lu.search.current.allcampus">
                    <value>
                        SELECT
                            clu.id
                        FROM CluCampusLocation loc
                        LEFT JOIN loc.clu clu
                        LEFT JOIN clu.officialIdentifier officialIdentifier
                        LEFT JOIN clu.descr cludesc
                        WHERE
                            clu.version.currentVersionStart &lt;= CURRENT_DATE
                            AND
                            (
                                clu.version.currentVersionEnd &gt; CURRENT_DATE
                                OR
                                clu.version.currentVersionEnd IS NULL
                            )
                            AND
                            (
                                UPPER( officialIdentifier.longName ) LIKE UPPER( '%'||:queryText||'%' )
                                OR
                                officialIdentifier.division LIKE UPPER( '%'||:queryText||'%' )
                                OR
                                officialIdentifier.code LIKE UPPER( '%'||:queryText||'%' )
                                OR
                                UPPER( cludesc.plain ) LIKE UPPER( '%'||:queryText||'%' )
                            )
                            AND
                            officialIdentifier.level LIKE :queryLevel
                    </value>
                </entry>

                <entry key="myplan.lu.search.fulltext">
                    <value>
                        SELECT
                            clu.id
                        FROM Clu clu
                        LEFT JOIN clu.officialIdentifier ident
                        LEFT JOIN clu.descr cludesc
                        WHERE
                            clu.version.currentVersionStart &lt;= CURRENT_DATE
                            AND
                            (
                                clu.version.currentVersionEnd &gt; CURRENT_DATE
                                OR
                                clu.version.currentVersionEnd IS NULL
                            )
                            AND
                            (
                                UPPER( ident.longName ) LIKE UPPER( '%'||:queryText||'%' )
                                OR
                                UPPER( cludesc.plain ) LIKE UPPER( '%'||:queryText||'%' )
                            )
                    </value>
                </entry>

                <entry key="myplan.lu.search.divisionAndCode">
                    <value>
                        SELECT
                            clu.id
                        FROM Clu clu
                        LEFT JOIN clu.officialIdentifier officialIdentifier
                        WHERE
                            clu.version.currentVersionStart &lt;= CURRENT_DATE
                            AND
                            (
                                clu.version.currentVersionEnd &gt; CURRENT_DATE
                                OR
                                clu.version.currentVersionEnd IS NULL
                            )
                            AND
                                officialIdentifier.division = :division
                            AND
                                officialIdentifier.suffixCode = :code
                    </value>
                </entry>
                <entry key="myplan.lu.search.divisionAndLevel">
                    <value>
                        SELECT
                            clu.id
                        FROM Clu clu
                        LEFT JOIN clu.officialIdentifier officialIdentifier
                        WHERE
                            clu.version.currentVersionStart &lt;= CURRENT_DATE
                            AND
                            (
                                clu.version.currentVersionEnd &gt; CURRENT_DATE
                                OR
                                clu.version.currentVersionEnd IS NULL
                            )
                            AND
                                officialIdentifier.division = :division
                            AND
                                officialIdentifier.level = :level
                    </value>
                </entry>
                <entry key="myplan.lu.search.division">
                    <value>
                        SELECT
                            clu.id
                        FROM Clu clu
                        LEFT JOIN clu.officialIdentifier officialIdentifier
                        WHERE
                            clu.version.currentVersionStart &lt;= CURRENT_DATE
                            AND
                            (
                                clu.version.currentVersionEnd &gt; CURRENT_DATE
                                OR
                                clu.version.currentVersionEnd IS NULL
                            )
                            AND
                                officialIdentifier.division = :division
                    </value>
                </entry>
            </map>
        </property>
    </bean>


</beans>